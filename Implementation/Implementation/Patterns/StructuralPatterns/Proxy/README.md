**Название и классификация паттерна﻿**
 
﻿**Заместитель﻿** — паттерн, структурирующий объекты.
 
﻿**Назначение﻿**
 
Является суррогатом другого объекта и контролирует доступ к нему.

﻿**Другие названия﻿**
 
Surrogate (суррогат).

﻿**Применимость﻿**
 
Паттерн заместитель применим во всех случаях, когда возникает необходимость сослаться на объект более гибким или нетривиальным способом, чем при использовании простого указателя. Несколько типичных ситуаций, в которых заместитель может оказаться полезным:
* удаленный заместитель предоставляет локального представителя для объекта, находящегося в другом адресном пространстве. В системе NEXTSTEP [Add94] для этой цели применяется класс NXProxy. Заместителя такого рода Джеймс Коплиен [Cop92] называет «послом» (Ambassador);
* виртуальный заместитель создает «тяжелые» объекты по требованию. Примером может служить класс ImageProxy, описанный в разделе «Мотивация»;
* защищающий заместитель контролирует доступ к исходному объекту. Такие заместители полезны, когда для разных объектов определены различные права доступа. Например, в операционной системе Choices [CIRM93] объекты KernelProxy ограничивают права доступа к объектам операционной системы;
* «умная» ссылка — это замена обычного указателя. Она позволяет выполнить дополнительные действия при доступе к объекту. К типичным применениям такой ссылки можно отнести:
  - подсчет числа ссылок на реальный объект, с тем чтобы занимаемую им память можно было освободить автоматически, когда не останется
ни одной ссылки (такие ссылки называют еще «умными» указателями [Ede92]);
  - загрузку объекта из долгосрочного хранилища в память при первом обращении к нему;
  - проверку и установку блокировки на реальный объект при обращении к нему, чтобы никакой другой объект не смог в это время изменить его.

﻿**Отношения﻿**
 
Proxy при необходимости переадресует запросы объекту RealSubject. Детали зависят от вида заместителя.

﻿**Результаты﻿**
 
С помощью паттерна заместитель при доступе к объекту вводится дополнительный уровень косвенности. У этого подхода есть много вариантов в зависимости от вида заместителя:
* удаленный заместитель может скрыть тот факт, что объект находится в другом адресном пространстве;
* виртуальный заместитель может выполнять оптимизацию, например создание объекта по требованию;
* защищающий заместитель и «умная» ссылка позволяют решать дополнительные задачи при доступе к объекту.

Есть еще одна оптимизация, которую паттерн заместитель иногда скрывает от клиента. Она называется копированием при записи (copy-on-write) и имеет много общего с созданием объекта по требованию. Копирование большого и сложного объекта — очень затратная операция. Если копия не модифицировалась, то нет смысла эту цену платить. Если отложить процесс
копирования, применив паттерн заместитель, то можно быть уверенным, что эта операция произойдет только тогда, когда он действительно был изменен.

Чтобы во время записи можно было копировать, необходимо подсчитывать ссылки на субъект. Копирование заместителя просто увеличивает счетчик ссылок. И только тогда, когда клиент запрашивает операцию, изменяющую субъект, заместитель действительно выполняет копирование. Одновременно заместитель должен уменьшить счетчик ссылок. Когда счетчик ссылок становится равным нулю, субъект уничтожается.

Копирование при записи может существенно уменьшить плату за копирование «тяжелых» субъектов.
